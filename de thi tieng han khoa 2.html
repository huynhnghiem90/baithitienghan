<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Thi Tiếng Hàn Trực Tuyến</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR Code generation library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        /* Custom styles for better look and feel */
        body {
            font-family: 'Inter', sans-serif;
        }
        .question-card {
            transition: all 0.3s ease-in-out;
        }
        .btn {
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8">

        <!-- Screen 1: QR Code & Welcome -->
        <div id="welcome-screen">
            <div class="text-center">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Bài Thi Tiếng Hàn</h1>
                <p class="text-gray-600 mb-6">Vui lòng quét mã QR để bắt đầu trên điện thoại của bạn.</p>
                <div class="flex justify-center mb-6">
                    <div id="qrcode" class="p-4 bg-white border rounded-lg shadow-sm"></div>
                </div>
                <p class="text-gray-600 mb-6">Hoặc nhấn nút bên dưới để tiếp tục.</p>
                <button id="start-form-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 btn">
                    Bắt đầu
                </button>
            </div>
        </div>

        <!-- Screen 2: User Info Form -->
        <div id="info-screen" class="hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Thông tin thí sinh</h1>
                <p class="text-gray-500 mt-2">Vui lòng nhập thông tin để tiếp tục.</p>
            </div>
            <form id="info-form">
                <div class="mb-4">
                    <label for="name" class="block text-gray-700 font-semibold mb-2">Họ và tên</label>
                    <input type="text" id="name" name="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Nguyễn Văn A" required>
                </div>
                <div class="mb-6">
                    <label for="email" class="block text-gray-700 font-semibold mb-2">Email</label>
                    <input type="email" id="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nguyenvana@email.com" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 btn">
                    Bắt đầu làm bài
                </button>
            </form>
        </div>

        <!-- Screen 3: The Test -->
        <div id="test-screen" class="hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">ĐỀ THI TIẾNG HÀN</h1>
                <p class="text-gray-500 mt-2">Thời gian làm bài: 60 phút</p>
            </div>
            <form id="test-form">
                <!-- Questions will be dynamically inserted here -->
                <div id="questions-container"></div>
                <button type="submit" class="w-full mt-8 bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 btn">
                    Nộp bài
                </button>
            </form>
        </div>

        <!-- Screen 4: Results -->
        <div id="result-screen" class="hidden">
            <div class="text-center">
                <svg class="mx-auto h-16 w-16 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h1 class="text-3xl font-bold text-gray-800 mt-4">Hoàn thành!</h1>
                <p class="text-gray-600 mt-2 mb-6">Cảm ơn bạn đã hoàn thành bài thi.</p>
                <div class="bg-gray-50 p-6 rounded-lg text-left">
                    <h2 class="font-bold text-xl mb-4">Kết quả của bạn</h2>
                    <p class="text-lg"><strong>Thí sinh:</strong> <span id="result-name"></span></p>
                    <p class="text-lg mb-4"><strong>Email:</strong> <span id="result-email"></span></p>
                    <p class="text-2xl font-bold text-indigo-600"><strong>Điểm trắc nghiệm:</strong> <span id="result-score"></span></p>
                </div>
                 <p class="text-sm text-gray-500 mt-6">Một email chứa kết quả chi tiết đã được soạn sẵn. Vui lòng nhấn gửi để hoàn tất.</p>
            </div>
        </div>
    </div>

<script>
    // --- DATABASE OF QUESTIONS ---
    // All questions from the document are stored here.
    const testData = {
        multipleChoice: [
            { question: "Điền từ thích hợp vào chỗ trống: 이것은 ( )입니까? - 책상입니다.", options: ["어디", "무엇", "언제", "무슨"], answer: "무엇" },
            { question: "Chọn tiểu từ đúng: 저( ) 윌슨입니다.", options: ["는", "가", "를", "에"], answer: "는" },
            { question: "Chọn tiểu từ đúng: 아니오, 구두( ) 아닙니다.", options: ["는", "를", "가", "에서"], answer: "가" },
            { question: "Điền từ thích hợp vào chỗ trống: 우리는 서울대학교( ) 한국어를 배웁니다.", options: ["에", "와", "에서", "도"], answer: "에서" },
            { question: "Điền từ thích hợp vào chỗ trống: 저는 학교( ) 갑니다.", options: ["에서", "를", "에", "고"], answer: "에" },
            { question: "'Thời tiết thế nào?' trong tiếng Hàn là gì?", options: ["이것은 무엇입니까?", "어디에 가십니까?", "날씨가 어떻습니까?", "무슨 요일입니까?"], answer: "날씨가 어떻습니까?" },
            { question: "Hoàn thành hội thoại: A: 오늘은 무슨 요일입니까? B: 오늘은 ( )입니다.", options: ["주말", "목요일", "내일", "어제"], answer: "목요일" },
            { question: "Chọn dạng phủ định đúng của '갑니다'.", options: ["가지 않습니다", "가지 없습니다", "안 갑니다", "없습니다"], answer: "가지 않습니다" },
            { question: "Từ '같이' có nghĩa là gì?", options: ["một mình", "cùng nhau", "cũng", "và"], answer: "cùng nhau" },
            { question: "Chọn dạng quá khứ của động từ '보다'.", options: ["봅니다", "보고", "보았어요", "보지만"], answer: "보았어요" },
            { question: "'Tôi học tiếng Hàn' trong tiếng Hàn là gì?", options: ["저는 한국 사람입니다.", "저는 한국어를 공부합니다.", "저는 한국에 갑니다.", "한국어가 재미있습니다."], answer: "저는 한국어를 공부합니다." },
            { question: "Chọn từ có nghĩa 'khó'.", options: ["쉽다", "재미있다", "덥다", "어렵다"], answer: "어렵다" },
            { question: "Hoàn thành câu: 내 방에는 책상( ) 침대가 있어요.", options: ["와", "에", "에서", "도"], answer: "와" },
            { question: "'어제' có nghĩa là gì?", options: ["hôm nay", "ngày mai", "cuối tuần", "hôm qua"], answer: "hôm qua" },
            { question: "Chọn từ nối thích hợp: 한국어는 재미있( ) 어려워요.", options: ["그리고", "지만", "그래서", "하고"], answer: "지만" },
            { question: "'Phòng của tôi ở trên tầng ba' được dịch sang tiếng Hàn là:", options: ["내 방은 3층에 없어요.", "내 방은 3층에 있어요.", "3층은 내 방입니다.", "내 방에는 3층이 있어요."], answer: "내 방은 3층에 있어요." },
            { question: "Chọn dạng đúng: 날씨가 (좋다) → 날씨가 ( ).", options: ["좋아요", "좋아고", "좋아지만", "좋지"], answer: "좋아요" },
            { question: "Từ nào sau đây có nghĩa là 'nhà hàng'?", options: ["학교", "도서관", "식당", "교실"], answer: "식당" },
            { question: "Hoàn thành câu: 철수 씨( ) 같이 도서관에 갑니다.", options: ["가", "는", "도", "를"], answer: "도" },
            { question: "'책상 옆에 텔레비전이 있습니다' có nghĩa là gì?", options: ["Cái tivi ở trên bàn.", "Cái bàn ở cạnh cái tivi.", "Có cái tivi ở cạnh cái bàn.", "Trong phòng có bàn và tivi."], answer: "Có cái tivi ở cạnh cái bàn." },
            { question: "Dạng kính ngữ của '읽다' là gì?", options: ["읽으시다", "읽지 않다", "읽고", "읽었다"], answer: "읽으시다" },
            { question: "'언제 한국에 오셨어요?' có nghĩa là gì?", options: ["Bạn là người nước nào?", "Bạn học tiếng Hàn ở đâu?", "Bạn đã đến Hàn Quốc khi nào?", "Tại sao bạn đến Hàn Quốc?"], answer: "Bạn đã đến Hàn Quốc khi nào?" },
            { question: "Chọn từ trái nghĩa với '덥다'.", options: ["춥다", "따뜻하다", "나쁘다", "좋다"], answer: "춥다" },
            { question: "Hoàn thành câu: 시내에서 친구를 ( ).", options: ["공부했어요", "만났어요", "읽었어요", "갔어요"], answer: "만났어요" },
            { question: "'-고' được dùng để:", options: ["Nối hai danh từ với nghĩa 'và'.", "Nối hai câu hoặc mệnh đề.", "Thể hiện sự đối lập 'nhưng'.", "Chỉ nơi chốn xảy ra hành động."], answer: "Nối hai câu hoặc mệnh đề." }
        ],
        fillInTheBlank: [
            { question: "N은/는 N입니다.", type: "construct" },
            { question: "N이/가 아닙니다.", type: "construct" },
            { question: "N에서 V-ㅂ니다/습니다.", type: "construct" },
            { question: "V-지 않습니다.", type: "construct" },
            { question: "S-고 S.", type: "construct" },
            { question: "N와/과 N.", type: "construct" },
            { question: "V-았/었어요.", type: "construct" },
            { question: "N도.", type: "construct" },
            { question: "V/A-아요/어요.", type: "construct" },
            { question: "S-지만 S.", type: "construct" },
            { question: "제 이름은 김영숙입니다.", type: "translate" },
            { question: "여기는 어디입니까?", type: "translate" },
            { question: "철수 씨도 같이 도서관에 갑니다.", type: "translate" },
            { question: "오늘은 날씨가 어떻습니까?", type: "translate" },
            { question: "주말에는 집에서 쉽니다.", type: "translate" },
            { question: "내 방에는 책상과 침대가 있어요.", type: "translate" },
            { question: "시내에서 친구를 만났어요.", type: "translate" },
            { question: "음악이 아주 좋았어요.", type: "translate" },
            { question: "언제 한국에 오셨어요?", type: "translate" },
            { question: "한국어 공부가 재미있지만 어려워요.", type: "translate" }
        ]
    };

    // --- DOM ELEMENTS ---
    const screens = {
        welcome: document.getElementById('welcome-screen'),
        info: document.getElementById('info-screen'),
        test: document.getElementById('test-screen'),
        result: document.getElementById('result-screen')
    };
    const startFormBtn = document.getElementById('start-form-btn');
    const infoForm = document.getElementById('info-form');
    const testForm = document.getElementById('test-form');
    const questionsContainer = document.getElementById('questions-container');
    const qrcodeContainer = document.getElementById('qrcode');
    
    let userInfo = {};

    // --- FUNCTIONS ---

    // Function to switch between screens
    function showScreen(screenName) {
        Object.values(screens).forEach(screen => screen.classList.add('hidden'));
        screens[screenName].classList.remove('hidden');
    }

    // Function to render all questions
    function renderTest() {
        let html = '';
        
        // Part 1: Multiple Choice
        html += '<h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Phần I: Trắc nghiệm</h2>';
        testData.multipleChoice.forEach((q, index) => {
            html += `<div class="question-card bg-white p-5 rounded-lg border border-gray-200 mb-4">
                        <p class="font-semibold text-gray-800 mb-4">${index + 1}. ${q.question}</p>
                        <div class="space-y-2">`;
            q.options.forEach((option, i) => {
                html += `<label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="mcq-${index}" value="${option}" class="mr-3" required>
                            <span>${option}</span>
                         </label>`;
            });
            html += `</div></div>`;
        });

        // Part 2: Free Response
        html += '<h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4 border-b pb-2">Phần II: Tự luận</h2>';
        html += '<h3 class="text-xl font-semibold text-gray-700 mb-4">A. Dựa vào các cấu trúc ngữ pháp đã cho, hãy viết một câu hoàn chỉnh.</h3>';
        testData.fillInTheBlank.filter(q => q.type === 'construct').forEach((q, index) => {
             html += `<div class="question-card bg-white p-5 rounded-lg border border-gray-200 mb-4">
                        <label for="fib-${index}" class="font-semibold text-gray-800 block mb-2">${index + 1}. ${q.question}</label>
                        <input type="text" id="fib-${index}" name="fib-${index}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Viết câu trả lời..." required>
                      </div>`;
        });
        
        html += '<h3 class="text-xl font-semibold text-gray-700 mt-6 mb-4">B. Dịch các câu sau sang tiếng Việt.</h3>';
        testData.fillInTheBlank.filter(q => q.type === 'translate').forEach((q, index) => {
             const originalIndex = index + testData.fillInTheBlank.filter(q => q.type === 'construct').length;
             html += `<div class="question-card bg-white p-5 rounded-lg border border-gray-200 mb-4">
                        <p class="font-semibold text-gray-800 mb-2">${index + 11}. ${q.question}</p>
                        <input type="text" id="fib-${originalIndex}" name="fib-${originalIndex}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Viết bản dịch..." required>
                      </div>`;
        });

        questionsContainer.innerHTML = html;
    }
    
    // Function to create and send email with results
    function sendResultsByEmail(score, total, answers) {
        const subject = `Kết quả bài thi Tiếng Hàn của ${userInfo.name}`;
        let body = `Thí sinh: ${userInfo.name}\n`;
        body += `Email: ${userInfo.email}\n\n`;
        body += `--- KẾT QUẢ ---\n`;
        body += `Điểm trắc nghiệm: ${score} / ${total}\n\n`;
        
        body += `--- CHI TIẾT BÀI LÀM ---\n\n`;
        
        body += `**Phần I: Trắc nghiệm**\n`;
        answers.mcq.forEach((ans, i) => {
            const question = testData.multipleChoice[i];
            const isCorrect = ans.answer === question.answer;
            body += `${i + 1}. ${question.question}\n`;
            body += `   - Trả lời: ${ans.answer} (${isCorrect ? 'Đúng' : 'Sai'})\n`;
            if (!isCorrect) {
                body += `   - Đáp án đúng: ${question.answer}\n`;
            }
            body += `\n`;
        });

        body += `**Phần II: Tự luận**\n`;
        answers.fib.forEach((ans, i) => {
            const question = testData.fillInTheBlank[i];
            const typeText = question.type === 'construct' ? 'Đặt câu' : 'Dịch';
            body += `${i + 1}. [${typeText}] ${question.question}\n`;
            body += `   - Trả lời: ${ans.answer}\n\n`;
        });
        
        // IMPORTANT: Replace with your actual email address
        const yourEmail = "huynhnghiem90@gmail.com"; 
        
        const mailtoLink = `mailto:${yourEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        
        // Open the user's default email client
        window.location.href = mailtoLink;
    }

    // --- EVENT LISTENERS ---

    // Generate QR Code on page load
    window.onload = function() {
        new QRCode(qrcodeContainer, {
            text: window.location.href,
            width: 200,
            height: 200,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
    };

    // Start button -> Show info form
    startFormBtn.addEventListener('click', () => {
        showScreen('info');
    });

    // Info form submission -> Store info and show test
    infoForm.addEventListener('submit', (e) => {
        e.preventDefault();
        userInfo = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value
        };
        renderTest();
        showScreen('test');
    });

    // Test form submission -> Grade test and show results
    testForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // --- Grading Logic ---
        const formData = new FormData(testForm);
        let score = 0;
        const userAnswers = { mcq: [], fib: [] };

        // Grade multiple choice
        testData.multipleChoice.forEach((q, index) => {
            const userAnswer = formData.get(`mcq-${index}`);
            userAnswers.mcq.push({ question: q.question, answer: userAnswer });
            if (userAnswer === q.answer) {
                score++;
            }
        });

        // Collect free-form answers
        testData.fillInTheBlank.forEach((q, index) => {
            const userAnswer = formData.get(`fib-${index}`);
            userAnswers.fib.push({ question: q.question, answer: userAnswer });
        });

        // --- Display Results ---
        document.getElementById('result-name').textContent = userInfo.name;
        document.getElementById('result-email').textContent = userInfo.email;
        document.getElementById('result-score').textContent = `${score} / ${testData.multipleChoice.length}`;
        
        showScreen('result');
        
        // --- Prepare and trigger email ---
        sendResultsByEmail(score, testData.multipleChoice.length, userAnswers);
    });

</script>

</body>
</html>

